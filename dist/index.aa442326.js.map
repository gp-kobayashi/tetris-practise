{"mappings":"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","sources":["src/tetris.js"],"sourcesContent":["class Block {\r\n    constructor(x, y){\r\n        this.x = x;\r\n        this.y = y;\r\n    };\r\n    draw(){\r\n        Push();\r\n        let s = 25;\r\n        Reflect(s*this.x, s*this.y, s, s);\r\n        pop();\r\n    }\r\n};\r\n\r\nclass Mino {\r\n    constructor(x, y, rot, shape){\r\n        this.x = x;\r\n        this.y = y;\r\n        this.rot = rot;\r\n        this.shape = shape\r\n    };\r\n    calcBlocks(){\r\n        let blocks= [];\r\n         switch(this.shape) {\r\n           case 0: blocks = [new Block(-1,0),new Block(0,0),new Block(0,-1),new Block(1,0)];break;\r\n           case 1: blocks = [new Block(-1,-1),new Block(0,-1),new Block(0,0),new Block(1,0)];break;\r\n           case 2: blocks = [new Block(-1,0),new Block(0,0),new Block(0,-1),new Block(1,-1)];break;\r\n           case 3: blocks = [new Block(-1,-2),new Block(-1,-1),new Block(-1,0),new Block(0,0)];break;\r\n           case 4: blocks = [new Block(0,-2),new Block(0,-1),new Block(-1,0),new Block(0,0)];break;\r\n           case 5: blocks = [new Block(-1,-1),new Block(-1,0),new Block(0,0),new Block(0,-1)];break;\r\n           case 6: blocks = [new Block(-2,0),new Block(-1,0),new Block(0,0),new Block(1,0)];break;\r\n            };\r\n        let rot = (40000000 + this.rot) % 4;\r\n        for(let r=0; r<rot; r++){\r\n            blocks = blocks.map(b => new Block(-b.y, b.x));\r\n        }\r\n        blocks.forEach(b => (b.x += this.x, b.y += this.y));\r\n        return blocks;\r\n    }\r\n    draw() {\r\n        let blocks = this.calcBlocks();\r\n\r\n        for(let b of blocks){\r\n            b.draw();\r\n        }\r\n    }\r\n    copy(){\r\n        return new Mino(this.x, this.y, this.rot, this.shape);\r\n    }\r\n};\r\n\r\nclass Field {\r\n    constructor(){\r\n        this.tiles = [\r\n            [1,0,0,0,0,0,0,0,0,0,0,1],\r\n            [1,0,0,0,0,0,0,0,0,0,0,1],\r\n            [1,0,0,0,0,0,0,0,0,0,0,1],\r\n            [1,0,0,0,0,0,0,0,0,0,0,1],\r\n            [1,0,0,0,0,0,0,0,0,0,0,1],\r\n            [1,0,0,0,0,0,0,0,0,0,0,1],\r\n            [1,0,0,0,0,0,0,0,0,0,0,1],\r\n            [1,0,0,0,0,0,0,0,0,0,0,1],\r\n            [1,0,0,0,0,0,0,0,0,0,0,1],\r\n            [1,0,0,0,0,0,0,0,0,0,0,1],\r\n            [1,0,0,0,0,0,0,0,0,0,0,1],\r\n            [1,0,0,0,0,0,0,0,0,0,0,1],\r\n            [1,0,0,0,0,0,0,0,0,0,0,1],\r\n            [1,0,0,0,0,0,0,0,0,0,0,1],\r\n            [1,0,0,0,0,0,0,0,0,0,0,1],\r\n            [1,0,0,0,0,0,0,0,0,0,0,1],\r\n            [1,0,0,0,0,0,0,0,0,0,0,1],\r\n            [1,0,0,0,0,0,0,0,0,0,0,1],\r\n            [1,0,0,0,0,0,0,0,0,0,0,1],\r\n            [1,0,0,0,0,0,0,0,0,0,0,1],\r\n            [1,1,1,1,1,1,1,1,1,1,1,1],\r\n        ];\r\n    };\r\n    tileAt(x, y) {\r\n        return this.tiles[y][x];\r\n    }\r\n    putBlock(x, y){\r\n        this.tiles[y][x]= 1;\r\n    }\r\n    findLineFilled(){\r\n        for(let y=0; y<21; y++){\r\n            let isFilled = this.tiles[y].every(t => t===1);\r\n            if(isFilled) return y;\r\n        }\r\n    }\r\n    draw() {\r\n        for(let y=0; y<21; y++){\r\n            for(let x=0; x=12; x++){\r\n                if (this.tileAt(x, y) === 0) continue;\r\n                new Block(x, y).draw();\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\nclass Game {\r\n    constructor(){\r\n        this.mino = Game.makeMino();\r\n        this.minoVx = 0;\r\n        this.field = new Field();\r\n        this.fc = 0;\r\n    }\r\n    static makeMino(){\r\n        return new Mino(5, 10, 0, floor(random(0,7)));\r\n    }\r\n    static isMinoMovable(mino, field){\r\n        let blocks = mino.calcBlocks();\r\n        return blocks.every(b => field.tileAt(b.x, b.y) === 0);\r\n    }\r\n    proc(){\r\n        //落下\r\n        if(this.fc % 20 === 19){\r\n            let futureMino = this.mino.copy();\r\n            futureMino.y += 1;\r\n            if(Game.isMinoMovable(futureMino, this.filed)){\r\n                this.mino.y += 1;\r\n            }else{\r\n                //接地\r\n                for(let b of this.mino.calcBlocks()){\r\n                  this.field.putBlock(b.x, b.y);\r\n                  this.mino = Game.makeMino();\r\n                }\r\n                \r\n            }\r\n        }\r\n        //左右移動\r\n        if(this.minoVx !== 0){\r\n            let futureMino = this.mino.copy();\r\n            futureMino.x += this.minoVx;\r\n            if(Game.isMinoMovable(futureMino, this.filed)){\r\n                this.mino.x += this.minoVx;\r\n            }\r\n            this.minoVx = 0;\r\n        }\r\n        //回転\r\n        if(this.minoVr !== 0){\r\n            let futureMino = this.mino.copy();\r\n            futureMino.rot += this.minoVr;\r\n            if(Game.isMinoMovable(futureMino, this.filed)){\r\n                this.mino.rot += this.minoVr;\r\n            }\r\n            this.minoVr = 0;\r\n        }\r\n\r\n        //描画\r\n        background(64);\r\n        this.mino.draw();\r\n        this.field.draw();\r\n        this.fc++;\r\n    }\r\n}\r\nlet geme;\r\n\r\nfunction keyPressed(){\r\n    if(keyCode === 65)Game.minoVx = -1;\r\n    if(keyCode === 68)Game.minoVx = 1;\r\n    if(keyCode === 81)Game.minoVr = -1;\r\n    if(keyCode === 69)Game.minoVr = 1;\r\n}\r\n\r\nfunction setup() {\r\n    createCanvas(400, 600);\r\n    background(64);\r\n    game = new Game();\r\n}\r\n\r\nfunction draw(){\r\n    game.proc();\r\n}"],"names":[],"version":3,"file":"index.aa442326.js.map","sourceRoot":"/__parcel_source_root/"}